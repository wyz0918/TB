define(function(require){function a(){var a=$(".J-chaptername").data("id");return $("[data-id="+a+"]")}function c(){var a,c,h,g=$(window),v=g.width(),w=g.height();$("#js-code-container").height(w-131),1200>v?($("#js-result-container").hide(),$("#js-result-drag-wrap").hide(),$("#js-toggle-width").hide().find("span").text("全屏"),$("#js-toggle-vsb").show().find("span").text("运行结果"),a=$("#js-aticle-container").width(),c=Math.max(400,v-a),$("#js-aticle-container").css({width:a}),$("#js-editor-container").css({left:a,width:c}),$("#js-result-container").css({left:a+c,width:0})):($("#js-result-container").show(),$("#js-result-drag-wrap").show(),$("#js-toggle-width").show().find("span").text("全屏"),$("#js-toggle-vsb").hide().find("span").text("运行结果"),a=400,h=400,c=v-a-h,$("#js-aticle-container").css({width:a}),$("#js-editor-container").css({left:a,width:c}),$("#js-result-container").css({left:a+c,width:h}));var j=$(".course-left");k=j.offset().top,_=j.offset().left,E.init(),$(".nano").nanoScroller(C),W.resetCount(),$(window).trigger("scroll")}function h(a){var c=[];$.each(v.editors,function(a,h){var $={filename:h.filename,lang:h.lang,content:h.getValue()};c.push($)});var h={lang:D,files:c};w.remote[a].set(h)}require("/static/lib/layer/1.6.0/layer.min.js"),require("tab"),require("/static/page/course/common/jquery.nanoscroller.js");var g=require("./common/animate-achievement"),v=require("ceditor"),w=require("/static/page/course/common/course_detail_common.js"),j=require("../common/verify-code.js"),b=require("store"),y=require("/static/component/base/util/guideLayer"),C={scrollTo:a()};$(function(){var a=b.get("isFirstVisit")||"Yes";"Yes"===a&&y.create()});var k,_;!function(){var a=b.get("ccl");a&&(a=a.split(",")),$("#js-code-container").height($(window).height()-131).show(),$(".nano").nanoScroller(C);var c=$(".js-course-menu"),h=$(".course-left");k=h.offset().top,_=h.offset().left,$(window).on("scroll",function(){var a=$(window).scrollTop();a>=k?c.css("position","fixed").css("left",_+"px"):c.css("position","absolute").css("left",0)})}(),$(window).on("beforeunload",function(){b.set("ccl",$("#js-aticle-container").width()+","+$("#js-editor-container").width())}),$("#js-toggle-width").click(function(){var a,c=$(this);"全屏"==c.text()?(c.find("span").text("收起"),$("#js-result-drag-wrap").hide(),a=$("#js-aticle-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a})):(c.find("span").text("全屏"),$("#js-result-drag-wrap").show(),a=$("#js-aticle-container").width()+$("#js-editor-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a}))}),$("#js-toggle-vsb").click(function(){var a,c=$(this);"运行结果"==c.text()?(c.find("span").text("收起结果"),a=$("#js-aticle-container").width(),$("#js-result-container").css({left:a,width:$(window).width()-a}).show()):(c.find("span").text("运行结果"),$("#js-result-container").hide())}),$("#js-result-container,#js-toggle-width").hover(function(){$("#js-toggle-width").css("visibility","visible")},function(){$("#js-toggle-width").css("visibility","hidden")}),$("#js-editor-drag-wrap,#js-result-drag-wrap").hover(function(){$(this).find("div").show()},function(){$(this).find("div").hide()});$(window).on("resize",function(){c()});var T=$("#J_TabType").find("li a"),J=[],I={js:"javascript",py:"python"};T.each(function(i,a){var c=$(a).text().split(".")[1];J.push(I[c]?I[c]:c)});var L=$("#J_EditorTabs").find(".editor-item"),D=($("#J_EditorReset"),$('a[href="#editor-tabs-css"]').attr("href"),$("#J_CodeLang").attr("data-lang")),v=v.init(L);$("#J_EditorTabs").fadeIn(),$(".editor-btn").fadeIn(),$("#J_TabType li:first-child").addClass("ui-tabs-active"),$("#J_TabType li").on("click",function(e){e.preventDefault(),$(this).addClass("ui-tabs-active").siblings().removeClass("ui-tabs-active"),$(".editor-item").addClass("visible-hid").eq($(this).index()).removeClass("visible-hid")});var W=function(){var a={},c=$(".js-editor-tab"),h=c.find(".editor-view"),g=c.find("ul"),v=c.find(".editor-left"),w=c.find(".editor-right"),j=0,b=0,y=[];return g.find("li").each(function(i){var a={};a.index=i,a.width=$(this).outerWidth(!0),a.left=$(this).position().left,y.push(a),j+=a.width}),g.css("width",j+2+"px"),a.resetCount=function(){c.hasClass("js-hasop")&&c.removeClass("js-hasop");var a=h.width();return j>a?(c.addClass("js-hasop"),b=c.find(".ui-tabs-active").index(),g.css("marginLeft",-y[b].left+"px"),void 0):(b=0,void g.css("marginLeft","0px"))},v.on("click",function(){b!==y.length-1&&g.css("marginLeft",-y[++b].left+"px")}),w.on("click",function(){0!==b&&g.css("marginLeft",-y[--b].left+"px")}),a}();$("#ques-bd").delegate(".Js-change-ques","click",function(){var a=$("#ques-group li");$(this).parent("li").removeClass("curr");var c,h=$(this).parent("li").index(),g=a.length-1;h===g?a.eq(0).addClass("curr"):$(this).parent("li").next().addClass("curr"),c=$("#ques-group .curr").find(".ques-title").attr("href"),$("#js-to-answer").attr("href",c)}),$("#js-editor-container").on("click","#J_issue_Close,.ques-title,#js-to-answer",function(){$("#J_ques_pop").hide()}),$("#J_Commit").on("click",function(){v.commit(D,function(a){w.tabList&&w.tabList.mate.load();var c=a.data.media,h=a.data.course,a=[];c&&a.push({mp:c.mp.point,desc:c.mp.desc}),h&&a.push({mp:h.mp.point,desc:h.mp.desc}),g(a),c&&$("#J_ques_pop").show()})}),$("#J_Save").on("click",function(){v.runCode(1)}),$(document).on("submit.imooc",function(){v.runCode(1)}),$.each("qa,note".split(","),function(a,c){w.remote[c].extendMethod("reset",function(){$(".js-shot-code[data-type='"+c+"']").removeClass("shoted").attr("title","点击拍照保存代码")})});var E={init:function(){var a;this.blocks=a=[],a.push({el:$("#js-aticle-container"),width:$("#js-aticle-container").width(),minWidth:parseInt($("#js-aticle-container").css("minWidth"))||320}),a.push({el:$("#js-editor-container"),width:$("#js-editor-container").width(),minWidth:parseInt($("#js-editor-container").css("minWidth"))||400}),a.push({el:$("#js-result-container"),width:$("#js-result-container").width(),minWidth:parseInt($("#js-result-container").css("minWidth"))||130}),$("#js-editor-drager,#js-result-drager").attr("unselectable","on").css("user-select","none").on("selectstart",!1).on("mousedown",$.proxy(this.start,this))},start:function(e){this.splitor=$(e.target).closest("#js-editor-drager").length&&1||2,this.x=e.clientX,$("#js-aticle-container,#js-editor-container,#js-result-container").attr("unselectable","on").css("user-select","none").on("selectstart.codedrager",!1),$(document).on("mousemove.codedrager",$.proxy(this.move,this)),$(document).on("mouseup.codedrager",$.proxy(this.stop,this)),$("#js-result-container").append("<div class='js-result-drag-mask' style='position:absolute;top:0;left:0;right:0;bottom:0;z-index:911;'></div>")},move:function(e){var a,c,h,$,g,v=e.clientX-this.x;v&&(a=this.blocks[this.splitor-1],c=this.blocks[this.splitor],v>0?(h=c,g=1):(h=a,g=-1),$=h.el.width(),v=Math.abs(v),$-v<h.minWidth&&(v=$-h.minWidth),v&&(this.x+=g*v,a.el.css({width:a.el.width()+g*v}),c.el.css({left:parseInt(c.el.css("left"))+g*v,width:c.el.width()-g*v})))},stop:function(){$(document).off("mousemove.codedrager"),$(document).off("mouseup.codedrager"),$("#js-aticle-container,#js-editor-container,#js-result-container").attr("unselectable","off").css("user-select","").off("selectstart.codedrager"),$("#js-result-container").find(".js-result-drag-mask").remove(),$(".editor-item").each(function(){ace.edit(this).renderer.onResize()}),W.resetCount()}};c(),$(document).on("click","#js-discuss-submit",function(){var a,c,g,v,b={},y=$(this);if($(".qa-pop .js-shot-code").hasClass("on")?h("qa"):w.remote.qa.reset(),!y.hasClass("submit-loading")){if(v=$.trim($("#js-qa-title").val()),v.length<5||v===$("#js-qa-title").attr("placeholder"))return void layer.msg("问答标题不能少于5个字",2,-1);if(v.length>255)return void layer.msg("问答标题不能大于255个字",2,-1);if(a=UE.getEditor("discuss-editor").getContent(),a=$.trim(a),c=$.trim(UE.getEditor("discuss-editor").getContentTxt()),g=c.length,0==g||"请输入讨论内容..."==c)return void layer.msg("请输入讨论内容",2,-1);if(5>g)return void layer.msg("输入不能小于5个字符",2,-1);if(a.length>2e4)return void layer.msg("输入不能超过20000个字",2,-1);var C=$.trim(j.getResult(".qa-pop .verify-code"));if(0==C.length)return void $(".qa-pop .verify-code").trigger("fail","请输入验证码");b.verify=C,$(".qa-pop .verify-code").trigger("succ"),$.extend(b,postData),b.content=a,b.title=v,w.remote.qa.prev(b),$(".interal-checked").length&&(b.frommedia=1),y.addClass("submit-loading").val("正在发布..."),$.ajax({url:"/course/ajaxsaveques",data:b,type:"post",dataType:"json",success:function(a){0==a.result?(layer.msg("发布成功!",2,-1),w.tabList.qa.load(),w.remote.qa.reset(),window.qapop.hide(),$("#interal-use").removeClass("interal-checked")):-103002==a.result?($(".qa-pop .verify-code").trigger("fail",a.msg),$(".qa-pop .verify-code-ipt").val(""),$(".qa-pop .js-verify-refresh").click()):layer.msg(a.msg,2,-1)},complete:function(){y.removeClass("submit-loading").val("发布")}})}}),$(document).on("click","#js-note-submit",function(){var a=$(this),c={};if(!a.hasClass("submit-loading")){if($(".note-pop .js-shot-code").hasClass("on")?h("note"):w.remote.note.reset(),0!==$(".publish-note-btns .verify-code-ipt").length){var g=$.trim(j.getResult(".publish-note-btns .verify-code"));if(console.log(g),0==g.length)return void $(".publish-note-btns .verify-code").trigger("fail","请输入验证码");$(".publish-note-btns .verify-code").trigger("succ"),c.verify=g}if(c.content=$("#js-note-textarea").val(),!$.trim(c.content))return void layer.msg("请输入内容",2,-1);var v=c.content.replace(/\s*$/,"").length;if(v>0&&3>v)return void layer.msg("输入不能小于3个字符",2,-1);if(v>1e3)return void layer.msg("输入不能超过1000个字",2,-1);$.extend(c,postData),w.remote.note.prev(c),a.addClass("submit-loading").val("正在保存..."),$.ajax({url:"/course/addnote",type:"post",dataType:"json",data:c,success:function(c){a.removeClass("submit-loading").val("保存"),0==c.result?(layer.msg("发布成功",2,-1),w.tabList.note.load(),w.remote.note.reset(),window.notepop.hide(),$(".js-select-state a").removeClass("active"),$(".js-select-state a[data-sort=last]").addClass("active")):1==c.data&&-1==c.result?j.renderVerifyCodeBlock(".publish-note-btns .verify-code","/course/getnotecode"):-103002==c.result?$(".note-pop .verify-code").trigger("fail",c.msg):layer.msg(c.msg,2,-1)}})}}),$(function(){function a(a){var c=$(a).attr("href"),h=($('<div id="js-imgview-mask" class="imgview-mask"></div>').appendTo($("body")).fadeIn(),$('<div id="js-imgview" class="show-img"><img id="bigimage" class="imgplacHolder" src="/static/img/loading-small.gif"><a href="#" class="imgview-close" ></a></div>').appendTo($("body"))),g=new Image;g.onload=function(){var a,g=$(window).height()-80,v=$(window).width()-80,w=this.height,j=this.width;(w>g||j>v)&&(a=Math.min(g/w,v/j),w=Math.round(w*a),j=Math.round(j*a)),h.animate({marginTop:-w/2,marginLeft:-j/2,width:j,height:w},200,function(){h.find("img").attr({width:j,height:w,src:c})})},g.src=c}$(document).off("click.closeview").on("click.closeview",".imgview-close,#js-imgview-mask",function(e){e.preventDefault(),$("#js-imgview-mask,#js-imgview").remove()}),$.fn.viewPhoto=function(){$(this).click(function(e){var c=$(e.target);c.is("img")&&c.parent().is("a")&&(a(c.parent()),e.preventDefault())})},$("#J_CodeDescr").viewPhoto()}),$("#J_EditorReset").on("click",function(){v._reset()}),$("#J_CodeQa").find("dt").on("click",function(){$(this).siblings("dd").slideToggle()}),OP_CONFIG.userInfo&&!function(){var a=60,c=(new Date).getTime();setInterval(function(){c=(new Date).getTime(),$.post("/course/ajaxmediauser",{mid:pageInfo.mid,time:a})},1e3*a),$(window).on("beforeunload",function(){$.ajax({url:"/course/ajaxmediauser",method:"post",async:!1,data:{mid:pageInfo.mid,time:((new Date).getTime()-c)/1e3}})})}();var M=$(".section-list");$(".chapter").on("click",function(){var a=$(this);a.hasClass("light")?(a.removeClass("light"),M.animate({right:-360},200)):(a.addClass("light"),M.animate({right:0},200))})});